{"ast":null,"code":"import _createForOfIteratorHelper from \"C:/PartTimeJob/blog/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.set.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { ref, computed } from 'vue';\nimport { isFunction } from '@vue/shared';\n\nfunction useFilter(props, tree) {\n  var hiddenNodeKeySet = ref( /* @__PURE__ */new Set([]));\n  var hiddenExpandIconKeySet = ref( /* @__PURE__ */new Set([]));\n  var filterable = computed(function () {\n    return isFunction(props.filterMethod);\n  });\n\n  function doFilter(query) {\n    var _a;\n\n    if (!filterable.value) {\n      return;\n    }\n\n    var expandKeySet = /* @__PURE__ */new Set();\n    var hiddenExpandIconKeys = hiddenExpandIconKeySet.value;\n    var hiddenKeys = hiddenNodeKeySet.value;\n    var family = [];\n    var nodes = ((_a = tree.value) == null ? void 0 : _a.treeNodes) || [];\n    var filter = props.filterMethod;\n    hiddenKeys.clear();\n\n    function traverse(nodes2) {\n      nodes2.forEach(function (node) {\n        family.push(node);\n\n        if (filter == null ? void 0 : filter(query, node.data)) {\n          family.forEach(function (member) {\n            expandKeySet.add(member.key);\n          });\n        } else if (node.isLeaf) {\n          hiddenKeys.add(node.key);\n        }\n\n        var children = node.children;\n\n        if (children) {\n          traverse(children);\n        }\n\n        if (!node.isLeaf) {\n          if (!expandKeySet.has(node.key)) {\n            hiddenKeys.add(node.key);\n          } else if (children) {\n            var allHidden = true;\n\n            var _iterator = _createForOfIteratorHelper(children),\n                _step;\n\n            try {\n              for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                var childNode = _step.value;\n\n                if (!hiddenKeys.has(childNode.key)) {\n                  allHidden = false;\n                  break;\n                }\n              }\n            } catch (err) {\n              _iterator.e(err);\n            } finally {\n              _iterator.f();\n            }\n\n            if (allHidden) {\n              hiddenExpandIconKeys.add(node.key);\n            } else {\n              hiddenExpandIconKeys[\"delete\"](node.key);\n            }\n          }\n        }\n\n        family.pop();\n      });\n    }\n\n    traverse(nodes);\n    return expandKeySet;\n  }\n\n  function isForceHiddenExpandIcon(node) {\n    return hiddenExpandIconKeySet.value.has(node.key);\n  }\n\n  return {\n    hiddenExpandIconKeySet: hiddenExpandIconKeySet,\n    hiddenNodeKeySet: hiddenNodeKeySet,\n    doFilter: doFilter,\n    isForceHiddenExpandIcon: isForceHiddenExpandIcon\n  };\n}\n\nexport { useFilter };","map":{"version":3,"mappings":"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","names":["useFilter","props","tree","hiddenNodeKeySet","ref","Set","hiddenExpandIconKeySet","filterable","computed","isFunction","filterMethod","doFilter","query","_a","value","expandKeySet","hiddenExpandIconKeys","hiddenKeys","family","nodes","treeNodes","filter","clear","traverse","nodes2","forEach","node","push","data","member","add","key","isLeaf","children","has","allHidden","childNode","pop","isForceHiddenExpandIcon"],"sources":["../../../../../../../packages/components/tree-v2/src/composables/useFilter.ts"],"sourcesContent":["import { computed, ref } from 'vue'\nimport { isFunction } from '@vue/shared'\nimport type { Ref } from 'vue'\nimport type { Tree, TreeKey, TreeNode, TreeProps } from '../types'\n\n// When the data volume is very large using filter will cause lag\n// I haven't found a better way to optimize it for now\n// Maybe this problem should be left to the server side\nexport function useFilter(props: TreeProps, tree: Ref<Tree | undefined>) {\n  const hiddenNodeKeySet = ref<Set<TreeKey>>(new Set([]))\n  const hiddenExpandIconKeySet = ref<Set<TreeKey>>(new Set([]))\n\n  const filterable = computed(() => {\n    return isFunction(props.filterMethod)\n  })\n\n  function doFilter(query: string) {\n    if (!filterable.value) {\n      return\n    }\n    const expandKeySet = new Set<TreeKey>()\n    const hiddenExpandIconKeys = hiddenExpandIconKeySet.value\n    const hiddenKeys = hiddenNodeKeySet.value\n    const family: TreeNode[] = []\n    const nodes = tree.value?.treeNodes || []\n    const filter = props.filterMethod\n    hiddenKeys.clear()\n    function traverse(nodes: TreeNode[]) {\n      nodes.forEach((node) => {\n        family.push(node)\n        if (filter?.(query, node.data)) {\n          family.forEach((member) => {\n            expandKeySet.add(member.key)\n          })\n        } else if (node.isLeaf) {\n          hiddenKeys.add(node.key)\n        }\n        const children = node.children\n        if (children) {\n          traverse(children)\n        }\n        if (!node.isLeaf) {\n          if (!expandKeySet.has(node.key)) {\n            hiddenKeys.add(node.key)\n          } else if (children) {\n            // If all child nodes are hidden, then the expand icon will be hidden\n            let allHidden = true\n            for (const childNode of children) {\n              if (!hiddenKeys.has(childNode.key)) {\n                allHidden = false\n                break\n              }\n            }\n            if (allHidden) {\n              hiddenExpandIconKeys.add(node.key)\n            } else {\n              hiddenExpandIconKeys.delete(node.key)\n            }\n          }\n        }\n        family.pop()\n      })\n    }\n    traverse(nodes)\n    return expandKeySet\n  }\n\n  function isForceHiddenExpandIcon(node: TreeNode): boolean {\n    return hiddenExpandIconKeySet.value.has(node.key)\n  }\n\n  return {\n    hiddenExpandIconKeySet,\n    hiddenNodeKeySet,\n    doFilter,\n    isForceHiddenExpandIcon,\n  }\n}\n"]},"metadata":{},"sourceType":"module"}