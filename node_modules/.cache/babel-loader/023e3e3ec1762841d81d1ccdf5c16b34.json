{"ast":null,"code":"import _typeof from \"C:/PartTimeJob/blog/node_modules/@babel/runtime/helpers/esm/typeof.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/es.array.some.js\";\nimport \"core-js/modules/es.array.index-of.js\";\nimport \"core-js/modules/es.regexp.constructor.js\";\nimport \"core-js/modules/es.regexp.dot-all.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.sticky.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport { inject, computed, getCurrentInstance, watch, toRaw, unref } from 'vue';\nimport { get } from 'lodash-unified';\nimport '../../../utils/index.mjs';\nimport { selectKey, selectGroupKey } from './token.mjs';\nimport { escapeStringRegexp } from '../../../utils/strings.mjs';\n\nfunction useOption(props, states) {\n  var select = inject(selectKey);\n  var selectGroup = inject(selectGroupKey, {\n    disabled: false\n  });\n  var isObject = computed(function () {\n    return Object.prototype.toString.call(props.value).toLowerCase() === \"[object object]\";\n  });\n  var itemSelected = computed(function () {\n    if (!select.props.multiple) {\n      return isEqual(props.value, select.props.modelValue);\n    } else {\n      return contains(select.props.modelValue, props.value);\n    }\n  });\n  var limitReached = computed(function () {\n    if (select.props.multiple) {\n      var modelValue = select.props.modelValue || [];\n      return !itemSelected.value && modelValue.length >= select.props.multipleLimit && select.props.multipleLimit > 0;\n    } else {\n      return false;\n    }\n  });\n  var currentLabel = computed(function () {\n    return props.label || (isObject.value ? \"\" : props.value);\n  });\n  var currentValue = computed(function () {\n    return props.value || props.label || \"\";\n  });\n  var isDisabled = computed(function () {\n    return props.disabled || states.groupDisabled || limitReached.value;\n  });\n  var instance = getCurrentInstance();\n\n  var contains = function contains() {\n    var arr = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    var target = arguments.length > 1 ? arguments[1] : undefined;\n\n    if (!isObject.value) {\n      return arr && arr.includes(target);\n    } else {\n      var valueKey = select.props.valueKey;\n      return arr && arr.some(function (item) {\n        return get(item, valueKey) === get(target, valueKey);\n      });\n    }\n  };\n\n  var isEqual = function isEqual(a, b) {\n    if (!isObject.value) {\n      return a === b;\n    } else {\n      var valueKey = select.props.valueKey;\n      return get(a, valueKey) === get(b, valueKey);\n    }\n  };\n\n  var hoverItem = function hoverItem() {\n    if (!props.disabled && !selectGroup.disabled) {\n      select.hoverIndex = select.optionsArray.indexOf(instance.proxy);\n    }\n  };\n\n  watch(function () {\n    return currentLabel.value;\n  }, function () {\n    if (!props.created && !select.props.remote) select.setSelected();\n  });\n  watch(function () {\n    return props.value;\n  }, function (val, oldVal) {\n    var _select$props = select.props,\n        remote = _select$props.remote,\n        valueKey = _select$props.valueKey;\n\n    if (!props.created && !remote) {\n      if (valueKey && _typeof(val) === \"object\" && _typeof(oldVal) === \"object\" && val[valueKey] === oldVal[valueKey]) {\n        return;\n      }\n\n      select.setSelected();\n    }\n  });\n  watch(function () {\n    return selectGroup.disabled;\n  }, function () {\n    states.groupDisabled = selectGroup.disabled;\n  }, {\n    immediate: true\n  });\n\n  var _toRaw = toRaw(select),\n      queryChange = _toRaw.queryChange;\n\n  watch(queryChange, function (changes) {\n    var _unref = unref(changes),\n        query = _unref.query;\n\n    var regexp = new RegExp(escapeStringRegexp(query), \"i\");\n    states.visible = regexp.test(currentLabel.value) || props.created;\n\n    if (!states.visible) {\n      select.filteredOptionsCount--;\n    }\n  });\n  return {\n    select: select,\n    currentLabel: currentLabel,\n    currentValue: currentValue,\n    itemSelected: itemSelected,\n    isDisabled: isDisabled,\n    hoverItem: hoverItem\n  };\n}\n\nexport { useOption };","map":{"version":3,"mappings":"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","names":["useOption","props","states","select","inject","selectKey","selectGroup","selectGroupKey","disabled","isObject","computed","Object","prototype","toString","call","value","toLowerCase","itemSelected","multiple","isEqual","modelValue","contains","limitReached","length","multipleLimit","currentLabel","label","currentValue","isDisabled","groupDisabled","instance","getCurrentInstance","arr","target","includes","valueKey","some","item","get","a","b","hoverItem","hoverIndex","optionsArray","indexOf","proxy","watch","created","remote","setSelected","val","oldVal","immediate","toRaw","queryChange","changes","unref","query","regexp","RegExp","escapeStringRegexp","visible","test","filteredOptionsCount"],"sources":["../../../../../../packages/components/select/src/useOption.ts"],"sourcesContent":["import { computed, getCurrentInstance, inject, toRaw, unref, watch } from 'vue'\nimport { get } from 'lodash-unified'\nimport { escapeStringRegexp } from '@element-plus/utils'\nimport { selectGroupKey, selectKey } from './token'\n\nimport type { Ref } from 'vue'\nimport type { QueryChangeCtx } from './token'\n\nexport function useOption(props, states) {\n  // inject\n  const select = inject(selectKey)\n  const selectGroup = inject(selectGroupKey, { disabled: false })\n\n  // computed\n  const isObject = computed(() => {\n    return (\n      Object.prototype.toString.call(props.value).toLowerCase() ===\n      '[object object]'\n    )\n  })\n\n  const itemSelected = computed(() => {\n    if (!select.props.multiple) {\n      return isEqual(props.value, select.props.modelValue)\n    } else {\n      return contains(select.props.modelValue as unknown[], props.value)\n    }\n  })\n\n  const limitReached = computed(() => {\n    if (select.props.multiple) {\n      const modelValue = (select.props.modelValue || []) as unknown[]\n      return (\n        !itemSelected.value &&\n        modelValue.length >= select.props.multipleLimit &&\n        select.props.multipleLimit > 0\n      )\n    } else {\n      return false\n    }\n  })\n\n  const currentLabel = computed(() => {\n    return props.label || (isObject.value ? '' : props.value)\n  })\n\n  const currentValue = computed(() => {\n    return props.value || props.label || ''\n  })\n\n  const isDisabled = computed(() => {\n    return props.disabled || states.groupDisabled || limitReached.value\n  })\n\n  const instance = getCurrentInstance()\n\n  const contains = (arr = [], target) => {\n    if (!isObject.value) {\n      return arr && arr.includes(target)\n    } else {\n      const valueKey = select.props.valueKey\n      return (\n        arr &&\n        arr.some((item) => {\n          return get(item, valueKey) === get(target, valueKey)\n        })\n      )\n    }\n  }\n\n  const isEqual = (a: unknown, b: unknown) => {\n    if (!isObject.value) {\n      return a === b\n    } else {\n      const { valueKey } = select.props\n      return get(a, valueKey) === get(b, valueKey)\n    }\n  }\n\n  const hoverItem = () => {\n    if (!props.disabled && !selectGroup.disabled) {\n      select.hoverIndex = select.optionsArray.indexOf(instance.proxy)\n    }\n  }\n\n  watch(\n    () => currentLabel.value,\n    () => {\n      if (!props.created && !select.props.remote) select.setSelected()\n    }\n  )\n\n  watch(\n    () => props.value,\n    (val, oldVal) => {\n      const { remote, valueKey } = select.props\n      if (!props.created && !remote) {\n        if (\n          valueKey &&\n          typeof val === 'object' &&\n          typeof oldVal === 'object' &&\n          val[valueKey] === oldVal[valueKey]\n        ) {\n          return\n        }\n        select.setSelected()\n      }\n    }\n  )\n\n  watch(\n    () => selectGroup.disabled,\n    () => {\n      states.groupDisabled = selectGroup.disabled\n    },\n    { immediate: true }\n  )\n\n  const { queryChange } = toRaw(select)\n  watch(queryChange, (changes: Ref<QueryChangeCtx>) => {\n    const { query } = unref(changes)\n\n    const regexp = new RegExp(escapeStringRegexp(query), 'i')\n    states.visible = regexp.test(currentLabel.value) || props.created\n    if (!states.visible) {\n      select.filteredOptionsCount--\n    }\n  })\n\n  return {\n    select,\n    currentLabel,\n    currentValue,\n    itemSelected,\n    isDisabled,\n    hoverItem,\n  }\n}\n"]},"metadata":{},"sourceType":"module"}